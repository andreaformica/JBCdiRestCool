<project name="HibernateTask">
	<import file="commontasks.xml" />

	<!-- Init -->
	<target name="init-hibernate" depends="init">
		<property name="hibernate.report.dir" value="${basedir}/hibernate-output" />
		<property name="hb.conf.file" value="${basedir}/hibernate.cfg.xml" />
		<property name="hb.reveng.file" value="${basedir}/hibernate.reveng.xml" />
		<property name="hb.conf.dir" value="${basedir}/etc" />
		<property name="hb.gen.dir" value="${basedir}/gen" />
		<property name="hb.src.dir" value="${src.dir}" />
		<property name="hb.build.dir" value="${basedir}/build/gen" />
		<property name="hb.lib.dir" value="${basedir}/hb-lib" />
		<property name="hb.build.classes.dir" value="${hb.build.dir}/classes" />
		<path id="hibernate.classpath">
			<fileset dir="${hb.lib.dir}">
				<include name="*.jar" />
			</fileset>
		</path>

		<path id="run.cp">
			<path refid="hibernate.classpath" />
			<path refid="project.class.path" />
			<path refid="jdbc.classpath" />
			<pathelement location="${hb.build.classes.dir}" />
			<pathelement location="${build.classes.dir}" />
		</path>
		<!--	<taskdef name="hibernate" classpathref="hibernate.classpath" classname="org.hibernate.hibernateAntTask" /-->
		<taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask" classpathref="run.cp" />

	</target>


	<!-- hibernate -->
	<!-- Prepare -->
	<target name="prepare-hibernate" depends="init-hibernate,prepare">
		<mkdir dir="${hb.gen.dir}" />
		<mkdir dir="${hb.build.dir}" />
		<mkdir dir="${hb.build.classes.dir}" />
	</target>

	<target name="clean-hibernate" depends="init-hibernate">
		<delete dir="${hb.gen.dir}" />
	</target>

	<target name="copy-resources" depends="prepare-hibernate" />
	<target name="compile" depends="copy-resources" />

	<target name="copy-pojos" depends="init-hibernate">
		<copy todir="${hb.src.dir}">
			<fileset dir="${hb.gen.dir}">
				<include name="**/*.java" />
			</fileset>
		</copy>
	</target>
	<target name="copy-hbm" depends="init-hibernate">
		<copy todir="${hb.conf.dir}">
			<fileset dir="${hb.gen.dir}">
				<include name="**/*hbm.xml" />
			</fileset>
		</copy>
	</target>

	<!-- run hibernate -->
	<target name="run-hibernate-genPojo" depends="prepare-hibernate">
		<hibernatetool destdir="${hb.gen.dir}">
			<classpath>
				<path location="${hb.build.classes.dir}" />
			</classpath>
			<configuration configurationfile="${hb.conf.file}">
				<fileset dir="${hb.conf.dir}">
					<include name="**/*.hbm.xml" />
					<exclude name="**/*Test.hbm.xml" />
				</fileset>
			</configuration>
			<hbm2java jdk5="true" ejb3="true" />
		</hibernatetool>
	</target>

	<!-- run hibernate to generate hbm.xml files -->
	<target name="run-hibernate-reveng" depends="prepare-hibernate">
		<hibernatetool destdir="${hb.gen.dir}">
			<classpath>
				<path location="${hb.build.classes.dir}" />
			</classpath>
			<jdbcconfiguration packagename="${hb.package.name}" configurationfile="${hb.conf.file}" revengfile="${hb.reveng.file}" />
			<hbm2hbmxml />
		</hibernatetool>
	</target>

	<!-- run hibernate to test hql queries dumping into files -->
	<target name="run-hibernate-query" depends="prepare-hibernate">
		<hibernatetool destdir="${hb.gen.dir}">
			<classpath>
				<path location="${hb.build.classes.dir}" />
			</classpath>
			<configuration configurationfile="${hb.conf.file}">
				<fileset dir="${hb.conf.dir}">
					<include name="**/*.hbm.xml" />
					<exclude name="**/*Test.hbm.xml" />
				</fileset>
			</configuration>

<query destfile="queryresult.txt">
   <hql>from atlas.muon.align.data.AlignAsapelement</hql>
</query>
		</hibernatetool>
	</target>


</project>
